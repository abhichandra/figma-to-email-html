<!DOCTYPE html>
<html>
<head>
  <title>Figma to Email HTML</title>
</head>
<body style="font-family:Arial, sans-serif; text-align:center; margin-top:50px;">
  <h2>Paste your Figma design link</h2>
  <input id="figmaInput" type="text" placeholder="https://www.figma.com/file/:key/:title?node-id=..." 
         style="width:60%; padding:10px;" />
  <button onclick="submitLink()" style="padding:10px 20px;">üöÄ Generate HTML</button>

  <pre id="output" style="text-align:left; margin:40px auto; width:80%; background:#f8f8f8; padding:20px; border:1px solid #ccc;"></pre>

  <script>
function extractParams(url) {
  try {
    const u = new URL(url.replace("/design/", "/file/")); // ‚úÖ normalize
    const segments = u.pathname.split('/');
    const fileKey = segments[2];
    const rawNodeId = u.searchParams.get("node-id");
    const nodeId = rawNodeId?.replace('-', ':'); // ‚úÖ fix nodeId format
    return { fileKey, nodeId };
  } catch (e) {
    return null;
  }
}


    async function submitLink() {
      const input = document.getElementById("figmaInput").value;
      const params = extractParams(input);
      const output = document.getElementById("output");

      if (!params || !params.fileKey) {
        output.innerText = "‚ùå Invalid Figma URL";
        return;
      }

      let url = `/figma/html?fileKey=${params.fileKey}`;
      if (params.nodeId) url += `&nodeId=${params.nodeId}`;

      output.innerText = "‚è≥ Loading...";
      try {
        const res = await fetch(url);
        const text = await res.text();
        output.innerText = text;
      } catch (err) {
        output.innerText = "‚ùå Error: " + err.message;
      }
    }
  </script>
</body>
</html>
